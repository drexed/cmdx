#!/usr/bin/env ruby
# frozen_string_literal: true

begin
  require "benchmark/ips"
rescue LoadError
  puts "benchmark/ips is not installed, please install it with `gem install benchmark-ips`"
  exit 1
end

# rubocop:disable Style/MixinUsage
require_relative "../lib/cmdx"

require_relative "../spec/support/helpers/task_builders"
require_relative "../spec/support/helpers/workflow_builders"
include CMDx::Testing::TaskBuilders
include CMDx::Testing::WorkflowBuilders
# rubocop:enable Style/MixinUsage

class BaseTask < CMDx::Task

  settings(logger: Logger.new(nil))

end

# While not the best setup for benchmarking raw performance
# since there is some metaprogramming going on with the task
# creators, its a good baseline to compare against each type
# of halting scenario.
successful_task = create_successful_task(base: BaseTask)
skipping_task = create_skipping_task(base: BaseTask)
failing_task = create_failing_task(base: BaseTask)
erroring_task = create_erroring_task(base: BaseTask)

Benchmark.ips do |x|
  x.report("success") { successful_task.execute }
  x.report("skipped") { skipping_task.execute }
  x.report("failed") { failing_task.execute }
  x.report("errored") { erroring_task.execute }
end
